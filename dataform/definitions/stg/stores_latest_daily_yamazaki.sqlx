-- Daily Yamazaki の store_id ごとに scraped_at 最新1件へ正規化。
config {
  type: "view",
  schema: "rideoasis_stg",
  name: "stores_latest_daily_yamazaki"
}

select
  "daily_yamazaki" as chain,
  store_id,
  store_name,
  address_raw,
  source_url,
  cast(null as string) as detail_url,
  scraped_at
from ${ref("stores_scraped_daily_yamazaki")}
where store_id is not null
qualify row_number() over (partition by store_id order by scraped_at desc) = 1
